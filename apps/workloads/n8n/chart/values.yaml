n8n:
  image:
    repository: n8nio/n8n
    tag: "1.121.3"
    pullPolicy: IfNotPresent

  existingEncryptionKeySecret: n8n-encryption-key

  db:
    type: postgresdb

  binaryData:
    availableModes:
      - filesystem
    mode: filesystem
    localStoragePath: /home/node/.n8n/binary-data
  timezone: UTC

  main:
    count: 1
    editorBaseUrl: https://n8n.oremuslabs.app
    persistence:
      enabled: true
      storageClass: longhorn
      size: 20Gi
      accessMode: ReadWriteOnce
      annotations:
        helm.sh/resource-policy: keep
    extraEnvVars:
      N8N_HOST: n8n.oremuslabs.app
      N8N_PROTOCOL: https
      N8N_SECURE_COOKIE: "true"
    resources:
      requests:
        cpu: 250m
        memory: 1Gi
      limits:
        cpu: 1000m
        memory: 2Gi

  worker:
    mode: queue
    count: 2
    waitMainNodeReady:
      enabled: true
      overwriteSchema: http
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi

  webhook:
    mode: queue
    url: https://n8n.oremuslabs.app/
    count: 2
    waitMainNodeReady:
      enabled: true
      overwriteSchema: http
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi
    mcp:
      enabled: true
      resources:
        requests:
          cpu: 200m
          memory: 256Mi
        limits:
          cpu: 500m
          memory: 512Mi

  ingress:
    enabled: true
    className: traefik
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    hosts:
      - host: n8n.oremuslabs.app
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: n8n-tls
        hosts:
          - n8n.oremuslabs.app

  redis:
    enabled: true
    master:
      persistence:
        enabled: true
        size: 5Gi
        storageClass: longhorn
        accessModes:
          - ReadWriteOnce
    auth:
      existingSecret: n8n-redis
      existingSecretPasswordKey: redis-password

  postgresql:
    enabled: true
    auth:
      username: n8n
      database: n8n
      existingSecret: n8n-postgresql
    primary:
      persistence:
        enabled: true
        size: 20Gi
        storageClass: longhorn
        accessModes:
          - ReadWriteOnce

certificate:
  enabled: true
  secretName: n8n-tls
  issuerRef:
    name: cloudflare-dns
    kind: ClusterIssuer
  hosts:
    - n8n.oremuslabs.app

gitSync:
  enabled: false
  schedule: "*/10 * * * *"
  repo: https://github.com/Oremus-Labs/ol-n8n.git
  branch: main
  gitSyncImage: registry.k8s.io/git-sync/git-sync:v4.1.1
  runnerImage: alpine:3.20
  gitSecret:
    name: ""              # optional: if empty, git-sync clones via HTTPS without secrets
    sshKey: id_ed25519
    knownHosts: known_hosts
  apiSecret:
    name: n8n-sync-secrets
    key: n8n-api-key
  apiUrl: http://n8n.n8n.svc.cluster.local:5678
  history:
    successful: 1
    failed: 3
  resources: {}
encryptionKeySecret:
  create: true
  name: n8n-encryption-key
  onepassword:
    itemPath: "vaults/fekk46izlezqrgocthhcn4xwp4/items/e6klrmpzeo5rnx3j37wbndxube"

postgresqlSecret:
  create: true
  name: n8n-postgresql
  onepassword:
    itemPath: "vaults/fekk46izlezqrgocthhcn4xwp4/items/bnjzrekjfru47hhdsd37my34jq"

redisSecret:
  create: true
  name: n8n-redis
  onepassword:
    itemPath: "vaults/fekk46izlezqrgocthhcn4xwp4/items/kepcrg6iqia6x3ccx6xayijbiy"
