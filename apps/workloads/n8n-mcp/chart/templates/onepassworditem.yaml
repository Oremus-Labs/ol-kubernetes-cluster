{{- $secret := .Values.onepassword.apiSecret }}
{{- if and $secret $secret.create $secret.itemPath }}
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  name: {{ $secret.name | default (printf "%s-sync" (include "n8n-mcp-wrapper.fullname" .)) }}
  namespace: {{ .Release.Namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "-2"
    argocd.argoproj.io/tracking-id: {{ printf "%s:%s/%s" .Release.Name "OnePasswordItem" ($secret.name | default (printf "%s-sync" (include "n8n-mcp-wrapper.fullname" .))) }}
spec:
  itemPath: {{ $secret.itemPath | quote }}
{{- end }}
